---
- name: Install packages
  import_role:
    name: common_roles/install_latest
  vars:
    packages:
      - "git"
      - "zsh"
      - "stow"

- name: Clone dotfiles
  git:
    repo: "{{ dotfiles_repo }}"
    dest: "/home/{{ username }}/dotfiles"
    track_submodules: true
    force: true

- name: Set zsh as default shell
  become: true
  user:
    name: "{{ item }}"
    shell: /usr/bin/zsh
  with_items:
    - "{{ username }}"
    - root

- name: Unstow dotfiles
  command:
    cmd: "stow -R ."
    chdir: "/home/{{ username }}/dotfiles"
  changed_when: true
