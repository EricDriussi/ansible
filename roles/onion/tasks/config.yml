---
- name: Config tor port and directory
  lineinfile:
    dest: /etc/tor/torrc
    regexp: "{{ item.regexp }}"
    line: "{{ item.line }}"
  with_items:
    - regexp: "^#?HiddenServiceDir"
      line: "HiddenServiceDir /var/lib/tor/hidden_service/"
    - regexp: "^#?HiddenServiceDir"
      line: "HiddenServicePort {{ ports.http }} 127.0.0.1:{{ ports.http }}"

- name: Restart tor
  service:
    name: tor
    state: restarted
